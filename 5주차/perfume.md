## 11. 시스템

### AOP란?

AOP란 **관점 지향 프로그래밍(Aspect Oriented Programming)**을 뜻합니다. 즉, 문제를 바라보는 관점을 기준으로 프로그래밍하는 기법을 말합니다.

예를 들어 은행 앱을 구현한다면 계좌이체, 입출금, 이자 계산 등이 핵심 기능일 것입니다. 그러나 이 세 가지 모두 로깅이나 보안, 트랜잭션 같은 로직이 필요하겠죠. 이렇게 부가적이지만 공통적으로 쓰이는 것을 공통관심사 혹은 횡단 관심사라고 하고, 이를 분리한 뒤 별도로 매핑하는 게 바로 AOP입니다. AOP는 이처럼** 비즈니스 로직에서 횡단 관심사를 분리해서 모듈성을 증가시키는 기법**입니다.

이처럼 관점으로 (혹은 유사한 개념으로) 관심사를 분리하는 방식은 강력한 힘을 갖고 있습니다. 코드 수준에서 아키텍처 관심사를 분리할 수 있다면, 진정한 테스트 주도 아키텍처 구축이 가능해집니다. 그때그떄 새로운 기술을 채택해 단순한 아키텍처를 복잡한 아키텍처로 키워갈 수도 있습니다.

즉, 아주 단순하고도 멋지게 분리된 아키텍처로 소프트웨어 프로젝트를 진행해 결과물을 출시한 뒤 애자일한 방식으로 확장해 나가는 것이 가능합니다. 설계가 최대한 분리되면 각 추상화 수준과 범위에서 코드가 적당히 단순하기 때문입니다.

## 12. 창발성

이 챕터에서 다루는 내용은 앞에서 이미 살펴본 내용들이라 따로 정리하지 않았습니다. 요약하자면 켄트 백의 4가지 설계 규칙을 풀어서 설명해준 장이었습니다.

- 모든 테스트를 실행한다. (테스트가 가능한 시스템을 만든다.)
- 중복을 없앤다.
- 프로그래머의 의도를 표현한다.
- 클래스와 메서드 수를 최소로 줄인다.

> 창발성(創發性): 남이 모르거나 하지 아니한 것을 처음으로 또는 새롭게 밝혀내거나 이루어 내는 성질.

그런데 다 읽고 나서도 왜 챕터 제목이 창발성인지 이해가 안되네요. 딱히 창의성과 관련된 내용을 설명하는 장도 아니고, 창의성이 아니라 창발성이라는 생소한 단어를 선택할 특별한 이유도 없어 보이는데 말이죠.

## 13. 동시성

13장에서는 동시성을 사용하는 이유와 그에 관련된 어려움을 다룹니다.

### 동시성이 필요한 이유

**1. 결합도를 낮춰서 시스템을 구조적으로 개선하기 위해**

> 동시성은 무엇과 언제를 분리하는 전략입니다. 무엇과 언제를 분리하면 앱의 구조와 효율이 극적으로 좋아집니다. 구조적인 관점에서 커다란 루프 하나가 아니라 작은 협력 프로그램 여러 개처럼 되고, 따라서 시스템을 이해하기 쉽고 분리하기가 쉬워지기 때문입니다.

**2. 응답 시간과 작업 처리량을 개선하기 위해**

> 받아와야 할 정보의 크기가 아주 클 때, 혹은 많은 사용자를 처리해야 할 때 하나의 스레드로는 처리하는 속도가 무척 오래 걸립니다. 다뤄야할 정보가 방대하거나 사용자 수가 많을 때 동시성을 도입하면 응답 속도가 빨라지는 장점이 있습니다.

그러나 이러한 장점에도 불구하고 동시성을 '잘' 구현하는 것은 대단히 어려운 일입니다.

### 동시성 방어 원칙

**1. 동시성 코드는 다른 코드와 분리하기**

단일 책임 원칙은 동시성에도 적용되는 원칙입니다. 동시성은 대단히 복잡하고 독자적인 난관이 있기 때문에 다른 코드와 분리해서 다루는 것이 좋습니다.

**2-1. 자료를 캡슐화 하기**

캡슐화 역시 마찬가지입니다. 객체를 공유하면 변경 사항이 그 객체를 공유하는 모든 코드에 영향을 미칩니다. 디버깅을 어렵게 하는 원인 중 하나입니다. 자료를 캡슐화하고 공유 자료를 최대한 줄여야 합니다.

공유 자료를 줄이는 최고의 방법은 처음부터 공유하지 않는 것입니다. 필요하다면 객체를 복사해 읽기 전용으로 사용하는 방법도 있습니다.

**2-2. 스레드를 독립적으로 구현하기**

스레드를 독립적으로 구현하세요. 즉, 다른 스레드와 자료를 공유하지 않고 각 스레드가 클라이언트 요청 하나를 처리하게 하세요. 가능다하면 다른 프로세서에서 돌려도 괜찮을 정도로 자료를 독립적으로 분할하는 것이 좋습니다. 그러면 동기화로 인한 문제가 일어날 가능성이 대폭 줄어듭니다.
